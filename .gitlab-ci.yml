variables:
  CUSTOM_CI_BUILDS_DIR: "/usr/workspace/variorum/gitlab-runner"
  BUILD_ROOT: ${CI_PROJECT_DIR}

stages:
#  - format
  - build

# Template for jobs triggering a build-and-test sub-pipelines:
.build:
  stage: build
  trigger:
    include:
      - local: '.gitlab/${CI_MACHINE}-build-and-test.yml'
    strategy: depend
    forward:
      pipeline_variables: true

#build-quartz-format:
# tags:
#   - shell
#   - quartz
# stage: format
# script:
#   - wget https://sourceforge.net/projects/astyle/files/astyle/astyle%203.1/astyle_3.1_linux.tar.gz
#   - tar -xf astyle_3.1_linux.tar.gz
#   - cd astyle/build/gcc && make
#   - export PATH="${PWD}/bin:${PATH}"
#   - cd -
#   - echo -e "PWD:" ${PWD}
#   - ./scripts/.ci-check-code-format.sh
#   - err=$?
#   - if [ $err -eq 0 ]; then exit 0; else echo -e "Astyle formatting needed!"; exit 1; fi
#
#build-quartz-format-rst:
# tags:
#   - shell
#   - quartz
# stage: format
# script:
#   - wget https://sourceforge.net/projects/astyle/files/astyle/astyle%203.1/astyle_3.1_linux.tar.gz
#   - ./scripts/.ci-check-rst-format.sh

## build across power lab
#build-cztb2:
# tags:
#   - shell
#   - cztb2
# stage: build
# script:
#   - git clone $VARIORUM_ANSIBLE
#   - cd variorum-ansible-setup
#   - ansible-playbook variorum-powerlab-playbook.yml

include:
  - local: .gitlab/subscribed-pipelines.yml
#  - local: .gitlab/quartz-build-and-test.yml
#  - local: .gitlab/catalyst-build-and-test.yml
#  - local: .gitlab/lassen-cpu-build-and-test.yml
#  - local: .gitlab/lassen-gpu-build-and-test.yml
#  - local: .gitlab/corona-build-and-test.yml


